(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[436],{5180:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/console",function(){return s(4242)}])},4242:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(5893),r=s(9008),n=s.n(r),i=s(4123),l=s(8901),o=s(7294),c=s(7066);let d="http://localhost:5000";function x(e){let{sessionId:t,isVisible:s,onClose:r}=e,{user:n}=(0,l.aF)(),[i,x]=(0,o.useState)({items:[],pagination:{page:1,per_page:20,total:0,pages:0,has_next:!1,has_prev:!1}}),[m,g]=(0,o.useState)([]),[u,h]=(0,o.useState)(null),[p,b]=(0,o.useState)(null),[y,v]=(0,o.useState)(new Set),[f,j]=(0,o.useState)(""),[N,w]=(0,o.useState)(""),[S,k]=(0,o.useState)(!1),[E,_]=(0,o.useState)("pending"),[C,I]=(0,o.useState)(1),[A,T]=(0,o.useState)(null),[R,D]=(0,o.useState)(""),O=(0,o.useRef)(null),P=(0,o.useCallback)(()=>{O.current&&clearInterval(O.current),O.current=setInterval(()=>{s&&n&&(z(),M(),U())},5e3)},[s,n,t,C,A,R]),L=(0,o.useCallback)(()=>{O.current&&(clearInterval(O.current),O.current=null)},[]);(0,o.useEffect)(()=>(s&&n?(z(),M(),U(),P()):L(),()=>L()),[s,n,t,C,A,R,P,L]),(0,o.useEffect)(()=>{let e=e=>{s&&p&&("a"===e.key&&e.altKey?(e.preventDefault(),G("approve")):"r"===e.key&&e.altKey?(e.preventDefault(),G("reject")):"e"===e.key&&e.altKey?(e.preventDefault(),G("edit")):"Escape"===e.key&&(b(null),v(new Set)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s,p]);let z=async()=>{try{k(!0);let e=new URLSearchParams({user_id:(null==n?void 0:n.id)||"",page:C.toString(),per_page:"20"});A&&e.append("priority",A.toString()),R&&e.append("response_type",R);let s=await c.Z.get("".concat(d,"/api/session/").concat(t,"/pending-responses?").concat(e));x(s.data)}catch(e){console.error("Error fetching pending responses:",e)}finally{k(!1)}},M=async()=>{try{let e=await c.Z.get("".concat(d,"/api/session/").concat(t,"/dm/notifications?user_id=").concat(null==n?void 0:n.id));g(e.data)}catch(e){console.error("Error fetching notifications:",e)}},U=async()=>{try{let e=await c.Z.get("".concat(d,"/api/session/").concat(t,"/dm/analytics?user_id=").concat(null==n?void 0:n.id));h(e.data)}catch(e){console.error("Error fetching analytics:",e)}},G=async e=>{if(p&&n)try{k(!0),await c.Z.post("".concat(d,"/api/session/").concat(t,"/pending-response/").concat(p.id,"/review"),{user_id:n.id,action:e,final_response:"edit"===e?f:void 0,dm_notes:N}),await z(),await M(),await U(),b(null),j(""),w("")}catch(e){console.error("Error reviewing response:",e)}finally{k(!1)}},W=async e=>{if(0!==y.size&&n)try{k(!0),await c.Z.post("".concat(d,"/api/session/").concat(t,"/pending-responses/bulk"),{user_id:n.id,action:e,response_ids:Array.from(y),dm_notes:N}),await z(),await M(),await U(),v(new Set),w("")}catch(e){console.error("Error bulk reviewing responses:",e)}finally{k(!1)}},B=async e=>{try{await c.Z.post("".concat(d,"/api/session/").concat(t,"/dm/notifications/").concat(e,"/mark-read"),{user_id:null==n?void 0:n.id}),await M(),await U()}catch(e){console.error("Error marking notification as read:",e)}},F=e=>{let t=new Set(y);t.has(e)?t.delete(e):t.add(e),v(t)},V=e=>{switch(e){case 3:return"text-red-400 bg-red-900";case 2:return"text-yellow-400 bg-yellow-900";default:return"text-green-400 bg-green-900"}},Z=e=>{switch(e){case 3:return"HIGH";case 2:return"MEDIUM";default:return"LOW"}},H=e=>new Date(e).toLocaleString();return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-gray-900 text-green-400 p-6 rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-400",children:"DM REVIEW DASHBOARD"}),(0,a.jsx)("button",{onClick:r,className:"text-red-400 hover:text-red-300 text-xl font-bold",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"flex mb-6 border-b border-gray-700",children:[(0,a.jsxs)("button",{className:"px-4 py-2 font-mono ".concat("pending"===E?"text-green-400 border-b-2 border-green-400":"text-gray-400 hover:text-green-400"),onClick:()=>_("pending"),children:["PENDING RESPONSES (",i.items.length,")"]}),(0,a.jsxs)("button",{className:"px-4 py-2 font-mono ".concat("notifications"===E?"text-green-400 border-b-2 border-green-400":"text-gray-400 hover:text-green-400"),onClick:()=>_("notifications"),children:["NOTIFICATIONS (",m.length,")"]}),(0,a.jsx)("button",{className:"px-4 py-2 font-mono ".concat("analytics"===E?"text-green-400 border-b-2 border-green-400":"text-gray-400 hover:text-green-400"),onClick:()=>_("analytics"),children:"ANALYTICS"})]}),"pending"===E&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-800 p-4 rounded border border-gray-600",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"PRIORITY FILTER"}),(0,a.jsxs)("select",{value:A||"",onChange:e=>{T(e.target.value?parseInt(e.target.value):null),I(1)},className:"bg-gray-700 text-green-400 p-2 rounded border border-gray-600 text-sm",children:[(0,a.jsx)("option",{value:"",children:"ALL"}),(0,a.jsx)("option",{value:"3",children:"HIGH"}),(0,a.jsx)("option",{value:"2",children:"MEDIUM"}),(0,a.jsx)("option",{value:"1",children:"LOW"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"TYPE FILTER"}),(0,a.jsxs)("select",{value:R,onChange:e=>{D(e.target.value),I(1)},className:"bg-gray-700 text-green-400 p-2 rounded border border-gray-600 text-sm",children:[(0,a.jsx)("option",{value:"",children:"ALL TYPES"}),(0,a.jsx)("option",{value:"narrative",children:"NARRATIVE"}),(0,a.jsx)("option",{value:"dice_roll",children:"DICE ROLL"}),(0,a.jsx)("option",{value:"npc_action",children:"NPC ACTION"})]})]})]}),y.size>0&&(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-400",children:[y.size," selected"]}),(0,a.jsx)("button",{onClick:()=>W("approve"),className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded",children:"Bulk Approve"}),(0,a.jsx)("button",{onClick:()=>W("reject"),className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm rounded",children:"Bulk Reject"})]})]}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Shortcuts: Alt+A (approve), Alt+R (reject), Alt+E (edit), Esc (clear selection)"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-mono text-yellow-400",children:"PENDING REVIEWS"}),i.items.length>0&&(0,a.jsx)("button",{onClick:()=>{y.size===i.items.length?v(new Set):v(new Set(i.items.map(e=>e.id)))},className:"text-xs text-blue-400 hover:text-blue-300",children:y.size===i.items.length?"Deselect All":"Select All"})]}),S?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"text-green-400",children:"Loading..."})}):0===i.items.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"No pending responses to review"}):(0,a.jsx)("div",{className:"space-y-4",children:i.items.map(e=>(0,a.jsx)("div",{className:"p-4 border rounded transition-colors ".concat((null==p?void 0:p.id)===e.id?"border-green-400 bg-green-900 bg-opacity-20":"border-gray-600 hover:border-gray-500"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("input",{type:"checkbox",checked:y.has(e.id),onChange:t=>{t.stopPropagation(),F(e.id)},className:"mt-1 text-green-400 bg-gray-700 border-gray-600 rounded focus:ring-green-500"}),(0,a.jsxs)("div",{className:"flex-1 cursor-pointer",onClick:()=>{b(e),j(e.ai_response),w("")},children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(V(e.priority)),children:Z(e.priority)}),(0,a.jsx)("span",{className:"text-blue-400 text-sm font-mono",children:e.response_type.toUpperCase()})]}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:H(e.created_at)})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-300 mb-2",children:[(0,a.jsx)("strong",{children:"Player:"})," ",e.user_id]}),(0,a.jsxs)("div",{className:"text-sm text-gray-300",children:[(0,a.jsx)("strong",{children:"Context:"})," ",e.context.substring(0,100),"..."]})]})]})},e.id))}),i.pagination.pages>1&&(0,a.jsxs)("div",{className:"mt-4 flex justify-between items-center text-sm",children:[(0,a.jsxs)("div",{className:"text-gray-400",children:["Page ",i.pagination.page," of ",i.pagination.pages,"(",i.pagination.total," total)"]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>I(C-1),disabled:!i.pagination.has_prev,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-green-400 rounded",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>I(C+1),disabled:!i.pagination.has_next,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-green-400 rounded",children:"Next"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-mono mb-4 text-yellow-400",children:"REVIEW PANEL"}),p?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded",children:[(0,a.jsx)("h4",{className:"text-green-400 font-mono mb-2",children:"AI RESPONSE"}),(0,a.jsx)("div",{className:"text-gray-300 text-sm max-h-40 overflow-y-auto",children:p.ai_response})]}),(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded",children:[(0,a.jsx)("h4",{className:"text-green-400 font-mono mb-2",children:"EDIT RESPONSE"}),(0,a.jsx)("textarea",{value:f,onChange:e=>j(e.target.value),className:"w-full h-32 bg-gray-700 text-green-400 p-2 rounded border border-gray-600 text-sm",placeholder:"Edit the AI response..."})]}),(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded",children:[(0,a.jsx)("h4",{className:"text-green-400 font-mono mb-2",children:"DM NOTES"}),(0,a.jsx)("textarea",{value:N,onChange:e=>w(e.target.value),className:"w-full h-20 bg-gray-700 text-green-400 p-2 rounded border border-gray-600 text-sm",placeholder:"Add notes about this review..."})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>G("approve"),className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-mono",disabled:S,children:"APPROVE (Alt+A)"}),(0,a.jsx)("button",{onClick:()=>G("edit"),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded font-mono",disabled:S,children:"EDIT (Alt+E)"}),(0,a.jsx)("button",{onClick:()=>G("reject"),className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-mono",disabled:S,children:"REJECT (Alt+R)"})]})]}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Select a response to review"})]})]})]}),"notifications"===E&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-mono mb-4 text-yellow-400",children:"NOTIFICATIONS"}),0===m.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"No notifications"}):(0,a.jsx)("div",{className:"space-y-4",children:m.map(e=>(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded cursor-pointer hover:border-gray-500",onClick:()=>B(e.id),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("span",{className:"text-blue-400 text-sm font-mono",children:e.notification_type.toUpperCase()}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:H(e.created_at)})]}),(0,a.jsx)("div",{className:"text-gray-300 text-sm",children:e.message})]},e.id))})]}),"analytics"===E&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-mono mb-4 text-yellow-400",children:"ANALYTICS"}),u?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded",children:[(0,a.jsx)("h4",{className:"text-green-400 font-mono mb-2",children:"QUEUE STATUS"}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Pending:"})," ",u.queue_status.pending_count]}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"High Priority:"})," ",u.queue_status.high_priority_count]})]}),(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded",children:[(0,a.jsx)("h4",{className:"text-green-400 font-mono mb-2",children:"REVIEW STATISTICS"}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Total Reviewed:"})," ",u.review_stats.total_reviewed]}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Approved:"})," ",u.review_stats.approved_count]}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Rejected:"})," ",u.review_stats.rejected_count]}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Edited:"})," ",u.review_stats.edited_count]}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Approval Rate:"})," ",u.review_stats.approval_rate.toFixed(2),"%"]}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Average Review Time:"})," ",u.review_stats.avg_review_time_minutes.toFixed(2)," minutes"]})]}),(0,a.jsxs)("div",{className:"p-4 border border-gray-600 rounded",children:[(0,a.jsx)("h4",{className:"text-green-400 font-mono mb-2",children:"NOTIFICATIONS"}),(0,a.jsxs)("div",{className:"text-gray-300 text-sm",children:[(0,a.jsx)("strong",{children:"Unread:"})," ",u.notifications.unread_count]})]})]}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Loading analytics..."})]})]})}):null}let m="http://localhost:5000";function g(e){let{sessionId:t,isVisible:s,onClose:r}=e,{user:n}=(0,l.aF)(),[i,d]=(0,o.useState)([]),[x,g]=(0,o.useState)(!1),[u,h]=(0,o.useState)(""),[p,b]=(0,o.useState)("dalle"),[y,v]=(0,o.useState)([]),[f,j]=(0,o.useState)("generate"),[N,w]=(0,o.useState)(null),[S,k]=(0,o.useState)(!1);(0,o.useRef)(null),(0,o.useEffect)(()=>{s&&n&&t&&(E(),_())},[s,n,t]);let E=async()=>{try{k(!0);let e=await c.Z.get("".concat(m,"/api/session/").concat(t,"/images?user_id=").concat(null==n?void 0:n.id,"&limit=20"));d(e.data.images||[])}catch(e){console.error("Error fetching images:",e)}finally{k(!1)}},_=async()=>{try{let e=await c.Z.get("".concat(m,"/api/session/").concat(t,"/image-providers"));v(e.data.providers||[]),e.data.default&&b(e.data.default)}catch(e){console.error("Error fetching providers:",e)}},C=async()=>{if(u.trim()&&n)try{g(!0);let e=await c.Z.post("".concat(m,"/api/session/").concat(t,"/generate-image-instant"),{user_id:n.id,prompt:u.trim(),provider:p,style_preferences:{quality:"standard",size:"1024x1024"}}),s={id:e.data.image_id,prompt:u.trim(),image_url:e.data.image_url,provider:e.data.provider,status:"completed",created_at:new Date().toISOString(),is_favorite:!1,tags:[]};d(e=>[s,...e]),h(""),j("gallery")}catch(e){console.error("Error generating image:",e),alert("Failed to generate image. Please try again.")}finally{g(!1)}},I=async(e,s)=>{try{await c.Z.post("".concat(m,"/api/session/").concat(t,"/image/").concat(e,"/favorite"),{user_id:null==n?void 0:n.id,is_favorite:!s}),d(t=>t.map(t=>t.id===e?{...t,is_favorite:!s}:t))}catch(e){console.error("Error toggling favorite:",e)}},A=()=>{w(null)},T=e=>{w(e)};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:[(0,a.jsxs)("div",{className:"bg-gray-900 rounded-lg shadow-xl w-11/12 max-w-6xl h-5/6 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-green-400",children:"Scene Visualizer"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex bg-gray-800 rounded-lg p-1",children:[(0,a.jsx)("button",{onClick:()=>j("generate"),className:"px-3 py-1 rounded text-sm transition-colors ".concat("generate"===f?"bg-green-600 text-white":"text-gray-400 hover:text-white"),children:"Generate"}),(0,a.jsxs)("button",{onClick:()=>j("gallery"),className:"px-3 py-1 rounded text-sm transition-colors ".concat("gallery"===f?"bg-green-600 text-white":"text-gray-400 hover:text-white"),children:["Gallery (",i.length,")"]})]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors",children:"✕"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:"generate"===f?(0,a.jsxs)("div",{className:"p-6 h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Scene Description"}),(0,a.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},placeholder:"Describe the scene you want to visualize... (e.g., 'A rain-soaked Seattle street with neon signs and corporate towers in the background')",className:"w-full h-32 px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-200 placeholder-gray-400 focus:outline-none focus:border-green-500 resize-none",disabled:x})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"AI Provider"}),(0,a.jsx)("select",{value:p,onChange:e=>b(e.target.value),className:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-200 focus:outline-none focus:border-green-500",disabled:x,children:y.map(e=>(0,a.jsx)("option",{value:e,children:"dalle"===e?"DALL-E 3":"stability"===e?"Stable Diffusion":e},e))})]}),(0,a.jsx)("button",{onClick:C,disabled:!u.trim()||x||0===y.length,className:"px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:x?(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"Generate Scene Image"}),0===y.length&&(0,a.jsx)("div",{className:"mt-4 p-4 bg-yellow-800 border border-yellow-600 rounded-lg",children:(0,a.jsx)("p",{className:"text-yellow-200 text-sm",children:"No image generation providers are configured. Please ensure OpenAI or Stability AI API keys are set up."})})]}):(0,a.jsx)("div",{className:"p-6 h-full overflow-y-auto",children:S?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("svg",{className:"animate-spin h-8 w-8 text-green-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):0===i.length?(0,a.jsxs)("div",{className:"text-center text-gray-400 py-12",children:[(0,a.jsx)("p",{children:"No images generated yet."}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Switch to the Generate tab to create your first scene visualization."})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-750 transition-colors",children:[(0,a.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>T(e),children:[(0,a.jsx)("img",{src:e.image_url,alt:e.prompt,className:"w-full h-48 object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center",children:(0,a.jsxs)("svg",{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("p",{className:"text-gray-300 text-sm line-clamp-2 mb-2",children:e.prompt}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 uppercase",children:e.provider}),(0,a.jsx)("button",{onClick:()=>I(e.id,e.is_favorite),className:"text-sm transition-colors ".concat(e.is_favorite?"text-yellow-400":"text-gray-500 hover:text-yellow-400"),children:"★"})]})]})]},e.id))})})})]}),N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-60",onClick:A,children:(0,a.jsxs)("div",{className:"max-w-4xl max-h-full m-4 bg-gray-900 rounded-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:N.image_url,alt:N.prompt,className:"max-w-full max-h-[80vh] object-contain"}),(0,a.jsx)("button",{onClick:A,className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-75 transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-700",children:[(0,a.jsx)("p",{className:"text-gray-300 mb-2",children:N.prompt}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,a.jsx)("span",{children:N.provider.toUpperCase()}),(0,a.jsx)("span",{children:new Date(N.created_at).toLocaleDateString()})]})]})]})})]}):null}let u={shadowrunBarren:{name:"Shadowrun Barren",background:"bg-gray-950",text:"text-red-300",secondaryText:"text-gray-400",accent:"bg-red-900 text-red-100",prompt:"text-green-500",input:"bg-gray-900 border-red-900 border",inputText:"text-red-200",secondaryBackground:"bg-gray-900"},matrix:{name:"Matrix",background:"bg-black",text:"text-green-400",secondaryText:"text-green-600",accent:"bg-green-700 text-green-200",prompt:"text-green-500",input:"bg-black border-green-700 border",inputText:"text-green-400",secondaryBackground:"bg-green-900 bg-opacity-20"},cyberpunk:{name:"Cyberpunk",background:"bg-purple-900",text:"text-pink-300",secondaryText:"text-blue-300",accent:"bg-pink-600 text-blue-200",prompt:"text-yellow-300",input:"bg-purple-800 border-pink-500 border",inputText:"text-pink-300",secondaryBackground:"bg-purple-800"},terminal:{name:"Terminal",background:"bg-black",text:"text-amber-400",secondaryText:"text-amber-600",accent:"bg-amber-800 text-amber-200",prompt:"text-amber-500",input:"bg-black border-amber-700 border",inputText:"text-amber-400",secondaryBackground:"bg-amber-900 bg-opacity-20"}},h=[{id:"xs",name:"Extra Small",class:"text-xs"},{id:"sm",name:"Small",class:"text-sm"},{id:"base",name:"Medium",class:"text-base"},{id:"lg",name:"Large",class:"text-lg"},{id:"xl",name:"Extra Large",class:"text-xl"}];function p(){var e;let{user:t,isSignedIn:s}=(0,l.aF)(),[r,n]=(0,o.useState)(""),[i,d]=(0,o.useState)([]),[m,p]=(0,o.useState)("> "),[b,y]=(0,o.useState)(!1),[v,f]=(0,o.useState)(!1),[j,N]=(0,o.useState)(!1),[w,S]=(0,o.useState)(!1),[k,E]=(0,o.useState)(null),[_,C]=(0,o.useState)(!1),I=(0,o.useRef)(null),A=(0,o.useRef)(null),[T,R]=(0,o.useState)({theme:"shadowrunBarren",fontSize:"base"});(0,o.useEffect)(()=>{let e=localStorage.getItem("shadowrun-settings");if(e)try{let t=JSON.parse(e);R(t)}catch(e){console.error("Failed to parse settings:",e)}p(s?"".concat((null==t?void 0:t.firstName)||"User","@SR > "):"> "),d([{command:"",output:'Shadowrun Interface Terminal v1.0\nType "help" for available commands.\nConnecting to the Matrix...'}])},[s,t]),(0,o.useEffect)(()=>{localStorage.setItem("shadowrun-settings",JSON.stringify(T))},[T]),(0,o.useEffect)(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[i]),(0,o.useEffect)(()=>{I.current&&I.current.focus()},[]);let D=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];d(r=>[...r,{command:e,output:t,isProcessing:s,isStreaming:a}])},O=async e=>{let s=e.split(" "),a=s[1],r=s.slice(2).join(" ");if("create"===a){if(!r){D(e,"Error: Session name is required. Usage: /session create [name]",!1);return}try{let s=await c.Z.post("http://localhost:5000/api/session",{name:r,gm_user_id:null==t?void 0:t.id});E(s.data.session_id),C(!0),D(e,'Session "'.concat(r,'" created successfully!\nSession ID: ').concat(s.data.session_id,"\nYou are the Game Master."),!1)}catch(t){D(e,"Error creating session: ".concat(t instanceof Error?t.message:"Unknown error"),!1)}}else if("join"===a){if(!r){D(e,"Error: Session ID is required. Usage: /session join [id]",!1);return}try{await c.Z.post("http://localhost:5000/api/session/".concat(r,"/join"),{user_id:null==t?void 0:t.id,role:"player"}),E(r),C(!1),D(e,"Joined session ".concat(r," as a player."),!1)}catch(t){D(e,"Error joining session: ".concat(t instanceof Error?t.message:"Unknown error"),!1)}}else D(e,"Error: Invalid session command. Use /session create [name] or /session join [id]",!1)},P=async e=>{let s=e.substring(4).trim();if(!s){D(e,"Error: Please provide a message for the AI. Usage: /ai [your message]",!1);return}if(!k){D(e,"Error: You must be in a session to use AI features.",!1);return}try{let i=await c.Z.post("http://localhost:5000/api/session/".concat(k,"/llm-with-review"),{user_id:null==t?void 0:t.id,context:s,response_type:"narrative",priority:1,require_review:!_});if("pending_review"===i.data.status)D(e,"AI response generated and sent for DM review.\n"+"Request ID: ".concat(i.data.pending_response_id,"\n")+"You will be notified when the DM approves your response.",!1);else{var a,r,n;D(e,(null===(n=i.data.choices)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:null===(a=r.message)||void 0===a?void 0:a.content)||"AI response received.",!1)}}catch(t){D(e,"Error getting AI response: ".concat(t instanceof Error?t.message:"Unknown error"),!1)}},L=async e=>{if(e.preventDefault(),!r.trim()||b)return;let t=r.trim();n(""),D(t,"",!0),await z(t)},z=async e=>{let t=e.toLowerCase();y(!0);try{if("clear"===t){d([]),y(!1);return}if("help"===t)D(e,"Available commands:\n- clear: Clear the console\n- help: Show this help message\n- theme [name]: Change console theme (shadowrunBarren, matrix, cyberpunk, terminal)\n- settings: Open settings panel\n- /session create [name]: Create a new game session (GM only)\n- /session join [id]: Join an existing session\n- /dm dashboard: Open DM review dashboard (GM only)\n- /ai [message]: Request AI response with DM review\n- /image gallery: Open image generation gallery\n- /image generate [description]: Generate a scene image\n- /scene [description]: Set a new scene\n- /roll [dice]: Roll dice (e.g., /roll 3d6)\n- /summon [character]: Summon an NPC\n- /echo [message]: Display a message to all players",!1);else if(t.startsWith("theme ")){let s=t.replace("theme ","");if(u[s]){let t={...T,theme:s};R(t),D(e,"Theme changed to ".concat(u[s].name),!1)}else D(e,"Theme not found. Available themes: ".concat(Object.keys(u).join(", ")),!1)}else if("settings"===t)f(!0),D(e,"Opening settings panel...",!1);else if(t.startsWith("/session "))await O(e);else if("/dm dashboard"===t)_?k?(N(!0),D(e,"Opening DM Review Dashboard...",!1)):D(e,"Error: You must be in a session to access the DM dashboard.",!1):D(e,"Error: Only Game Masters can access the DM dashboard.",!1);else if(t.startsWith("/ai "))await P(e);else if("/image gallery"===t)k?(S(!0),D(e,"Opening Scene Visualizer...",!1)):D(e,"Error: You must be in a session to access the image gallery.",!1);else if(t.startsWith("/image generate ")){let t=e.substring(16);k?t.trim()?(D(e,'Generating image for: "'.concat(t,'"\nOpening Scene Visualizer...'),!1),S(!0)):D(e,"Error: Please provide a scene description to generate.",!1):D(e,"Error: You must be in a session to generate images.",!1)}else if(t.startsWith("/scene ")){let t=e.substring(7);D(e,"Setting scene: ".concat(t,"\nThe GM is describing the scene..."),!1)}else if(t.startsWith("/roll ")){let t=e.substring(6);D(e,"Rolling ".concat(t,"...\nResult: 14 (simulated roll)"),!1)}else D(e,"Unknown command: ".concat(e,'\nType "help" for available commands.'),!1)}catch(t){console.error("Error processing command:",t),D(e,"Error: ".concat(t instanceof Error?t.message:"Unknown error processing command"),!1)}finally{y(!1)}},M=u[T.theme],U=(null===(e=h.find(e=>e.id===T.fontSize))||void 0===e?void 0:e.class)||"text-base";return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col ".concat(M.background),children:[(0,a.jsx)("header",{className:"p-2 border-b border-red-900",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"".concat(M.prompt," font-mono font-bold"),children:"SHADOWRUN MATRIX INTERFACE"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{onClick:()=>f(!0),className:"px-3 py-1 rounded ".concat(M.accent," hover:opacity-80"),children:"Settings"})})]})}),(0,a.jsx)("div",{ref:A,className:"flex-1 p-4 overflow-y-auto font-mono ".concat(U),onClick:()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.focus()},children:i.map((e,t)=>(0,a.jsxs)("div",{className:"mb-4",children:[e.command&&(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("span",{className:"".concat(M.prompt," mr-2"),children:m}),(0,a.jsx)("span",{className:M.text,children:e.command})]}),(0,a.jsxs)("div",{className:"pl-4 whitespace-pre-wrap ".concat(M.secondaryText),children:[e.output,e.isProcessing&&(0,a.jsx)("span",{className:"streaming-cursor ml-1"})]})]},t))}),(0,a.jsx)("form",{onSubmit:L,className:"p-2 border-t border-red-900",children:(0,a.jsxs)("div",{className:"flex items-center ".concat(M.input," p-2 rounded"),children:[(0,a.jsx)("span",{className:"".concat(M.prompt," mr-2"),children:m}),(0,a.jsx)("input",{ref:I,type:"text",value:r,onChange:e=>n(e.target.value),className:"flex-1 bg-transparent outline-none ".concat(M.inputText),disabled:b,placeholder:b?"Processing...":"Type a command..."})]})}),v&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"".concat(M.secondaryBackground," p-6 rounded-lg max-w-md w-full"),children:[(0,a.jsx)("h2",{className:"".concat(M.prompt," text-xl font-bold mb-4"),children:"Console Settings"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"".concat(M.text," block mb-2"),children:"Theme"}),(0,a.jsx)("select",{value:T.theme,onChange:e=>R({...T,theme:e.target.value}),className:"w-full p-2 bg-gray-800 text-white rounded",children:Object.entries(u).map(e=>{let[t,s]=e;return(0,a.jsx)("option",{value:t,children:s.name},t)})})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"".concat(M.text," block mb-2"),children:"Font Size"}),(0,a.jsx)("select",{value:T.fontSize,onChange:e=>R({...T,fontSize:e.target.value}),className:"w-full p-2 bg-gray-800 text-white rounded",children:h.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 rounded ".concat(M.accent),children:"Close"})})]})}),j&&k&&(0,a.jsx)(x,{sessionId:k,isVisible:j,onClose:()=>N(!1)}),w&&k&&(0,a.jsx)(g,{sessionId:k,isVisible:w,onClose:()=>S(!1)})]})}function b(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"Shadowrun Interface | Console"}),(0,a.jsx)("meta",{name:"description",content:"Shadowrun RPG terminal interface"})]}),(0,a.jsx)(i.CH,{children:(0,a.jsx)("div",{className:"min-h-screen bg-sr-dark flex flex-col",children:(0,a.jsx)(p,{})})}),(0,a.jsx)(i.tj,{children:(0,a.jsx)(l.N1,{})})]})}}},function(e){e.O(0,[703,888,774,179],function(){return e(e.s=5180)}),_N_E=e.O()}]);