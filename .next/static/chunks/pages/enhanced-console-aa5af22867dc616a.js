(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{2011:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/enhanced-console",function(){return s(3373)}])},3373:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var n=s(5893),a=s(9008),r=s.n(a),c=s(4123),o=s(8901),i=s(7294),l=s(1265);let d={help:{name:"help",aliases:["h","?"],description:"Show available commands or detailed help for a specific command",usage:"help [command]",category:"basic",parameters:[{name:"command",type:"string",required:!1,description:"Specific command to get help for"}]},clear:{name:"clear",aliases:["cls","clr"],description:"Clear the console output",usage:"clear",category:"basic"},roll:{name:"roll",aliases:["r"],description:"Roll dice using Shadowrun or standard notation",usage:"roll <dice> [limit] [edge] | roll <standard_dice>",category:"dice",parameters:[{name:"dice",type:"string",required:!0,description:'Dice to roll (e.g., "12", "3d6", "init 8")'}]},scene:{name:"scene",aliases:["s"],description:"Set or describe the current scene",usage:"scene <description>",category:"gm",requiresGM:!0,parameters:[{name:"description",type:"string",required:!0,description:"Scene description"}]},echo:{name:"echo",aliases:["say","broadcast"],description:"Send a message to all players in the session",usage:"echo <message>",category:"game",parameters:[{name:"message",type:"string",required:!0,description:"Message to broadcast"}]},summon:{name:"summon",aliases:["spawn","npc"],description:"Summon an NPC to the scene",usage:"summon <name> [archetype]",category:"gm",requiresGM:!0,parameters:[{name:"name",type:"string",required:!0,description:"NPC name"},{name:"archetype",type:"string",required:!1,description:"NPC archetype"}]},initiative:{name:"initiative",aliases:["init"],description:"Roll initiative or manage initiative order",usage:"initiative [bonus] | initiative start | initiative next",category:"game",parameters:[{name:"action",type:"string",required:!1,description:"init action or bonus"}]},edge:{name:"edge",aliases:["e"],description:"Spend edge on a dice roll",usage:"edge <dice> <action>",category:"dice",parameters:[{name:"dice",type:"number",required:!0,description:"Number of dice to roll"},{name:"action",type:"string",required:!0,description:"Edge action",options:["reroll","explode","pushLimit"]}]},test:{name:"test",aliases:["check"],description:"Make a skill test against a threshold",usage:"test <dice> <threshold>",category:"dice",parameters:[{name:"dice",type:"number",required:!0,description:"Dice pool"},{name:"threshold",type:"number",required:!0,description:"Success threshold"}]},matrix:{name:"matrix",aliases:["hack","deck"],description:"Enter the Matrix or perform matrix actions",usage:"matrix <action>",category:"matrix",parameters:[{name:"action",type:"string",required:!0,description:"Matrix action",options:["enter","exit","hack","scan"]}]},status:{name:"status",aliases:["stat","info"],description:"Show current session and character status",usage:"status",category:"game"},theme:{name:"theme",aliases:["skin"],description:"Change console theme",usage:"theme <theme_name>",category:"basic",parameters:[{name:"theme",type:"string",required:!0,description:"Theme name",options:["shadowrunBarren","matrix","cyberpunk","terminal"]}]}};function u(e){let t=e.toLowerCase();if(d[t])return d[t];for(let e of Object.values(d))if(e.aliases.includes(t))return e;return null}function h(e){let t=e.trim(),s=t.split(/\s+/),n=s[0].toLowerCase(),a=s.slice(1),r=t.substring(n.length).trim();return{command:n,args:a,rawArgs:r}}async function m(e,t){try{let{command:s,args:n,rawArgs:a}=h(e),r=u(s);if(!r)return{success:!1,output:"Unknown command: ".concat(s,'\nType "help" for available commands.')};if(r.requiresGM&&!t.isGM)return{success:!1,output:'Command "'.concat(r.name,'" requires GM privileges.')};switch(r.name){case"help":if(n.length>0){let e=u(n[0]);if(!e)return{success:!1,output:'No help available for "'.concat(n[0],'"')};{let t;return{success:!0,output:(t="".concat(e.name.toUpperCase(),"\n")+("Description: ".concat(e.description,"\n")+"Usage: ".concat(e.usage,"\n")+"Category: ".concat(e.category,"\n")),e.aliases.length>0&&(t+="Aliases: ".concat(e.aliases.join(", "),"\n")),e.requiresGM&&(t+="⚠️ GM Only command\n"),e.parameters&&e.parameters.length>0&&(t+="\nParameters:\n",e.parameters.forEach(e=>{let s=e.required?"Required":"Optional";t+="  ".concat(e.name," (").concat(e.type,", ").concat(s,"): ").concat(e.description,"\n"),e.options&&(t+="    Options: ".concat(e.options.join(", "),"\n"))})),t)}}}{let e;return{success:!0,output:(e="SHADOWRUN INTERFACE COMMANDS\n\n",["basic","game","dice","character","gm","matrix"].forEach(t=>{let s=Object.values(d).filter(e=>e.category===t);s.length>0&&(e+="".concat(t.toUpperCase()," COMMANDS:\n"),s.forEach(t=>{let s=t.aliases.length>0?" (".concat(t.aliases.join(", "),")"):"";e+="  ".concat(t.name).concat(s," - ").concat(t.description,"\n")}),e+="\n")}),e+='Type "help <command>" for detailed information about a specific command.\nUse Tab for auto-completion and Up/Down arrows for command history.')}}case"clear":return{success:!0,output:"CLEAR_CONSOLE"};case"roll":if(0===n.length)return{success:!1,output:"Usage: roll <dice>\nExamples: roll 12, roll 3d6, roll init 8"};try{let e=(0,l.iI)(a),t=(0,l.EA)(e,a);return{success:!0,output:t,broadcast:!0,data:e}}catch(e){return{success:!1,output:"Dice error: ".concat(e instanceof Error?e.message:"Unknown error")}}case"echo":if(0===a.length)return{success:!1,output:"Usage: echo <message>"};return{success:!0,output:"\uD83D\uDCE2 ".concat(t.userId,": ").concat(a),broadcast:!0};case"scene":if(0===a.length)return{success:!1,output:"Usage: scene <description>"};return{success:!0,output:"\uD83C\uDFAC Scene Set: ".concat(a,"\n\nThe GM is describing the scene..."),broadcast:!0};case"status":let c=["User: ".concat(t.userId),"Session: ".concat(t.sessionId||"None"),"Role: ".concat(t.isGM?"Game Master":"Player"),"Matrix Status: Disconnected","Edge: 3/3","Initiative: Not rolled"];return{success:!0,output:c.join("\n")};case"test":if(n.length<2)return{success:!1,output:"Usage: test <dice> <threshold>"};try{let e=parseInt(n[0]),t=parseInt(n[1]),s=(0,l.iI)(e.toString()),a=s.hits>=t,r=s.hits-t,c=(0,l.EA)(s,"".concat(e," dice vs threshold ").concat(t));return c+="\n".concat(a?"✅":"❌"," ").concat(a?"Success (".concat(r," net hits)"):"Failure"),{success:!0,output:c,broadcast:!0,data:{...s,threshold:t,success:a,netHits:r}}}catch(e){return{success:!1,output:"Test error: ".concat(e instanceof Error?e.message:"Unknown error")}}default:return{success:!1,output:'Command "'.concat(r.name,'" not yet implemented.')}}}catch(e){return{success:!1,output:"Command execution error: ".concat(e instanceof Error?e.message:"Unknown error")}}}class p{addCommand(e){e.trim()&&e!==this.history[this.history.length-1]&&(this.history.push(e),this.history.length>this.maxHistory&&this.history.shift(),this.currentIndex=this.history.length,this.saveToStorage())}getPrevious(){return 0===this.history.length?null:(this.currentIndex>0&&this.currentIndex--,this.history[this.currentIndex]||null)}getNext(){return 0===this.history.length?null:this.currentIndex<this.history.length-1?(this.currentIndex++,this.history[this.currentIndex]):(this.currentIndex=this.history.length,"")}reset(){this.currentIndex=this.history.length}getHistory(){return[...this.history]}clearHistory(){this.history=[],this.currentIndex=-1,localStorage.removeItem("shadowrun-command-history")}saveToStorage(){try{localStorage.setItem("shadowrun-command-history",JSON.stringify(this.history))}catch(e){console.warn("Failed to save command history:",e)}}loadFromStorage(){try{let e=localStorage.getItem("shadowrun-command-history");e&&(this.history=JSON.parse(e),this.currentIndex=this.history.length)}catch(e){console.warn("Failed to load command history:",e)}}constructor(){this.history=[],this.currentIndex=-1,this.maxHistory=100}}s(9090);let g={shadowrunBarren:{name:"Shadowrun Barren",background:"bg-gray-950",text:"text-red-300",secondaryText:"text-gray-400",accent:"bg-red-900 text-red-100",prompt:"text-green-500",input:"bg-gray-900 border-red-900 border",inputText:"text-red-200",secondaryBackground:"bg-gray-900",highlight:"bg-red-900 bg-opacity-30"},matrix:{name:"Matrix",background:"bg-black",text:"text-green-400",secondaryText:"text-green-600",accent:"bg-green-700 text-green-200",prompt:"text-green-500",input:"bg-black border-green-700 border",inputText:"text-green-400",secondaryBackground:"bg-green-900 bg-opacity-20",highlight:"bg-green-700 bg-opacity-30"},cyberpunk:{name:"Cyberpunk",background:"bg-purple-900",text:"text-pink-300",secondaryText:"text-blue-300",accent:"bg-pink-600 text-blue-200",prompt:"text-yellow-300",input:"bg-purple-800 border-pink-500 border",inputText:"text-pink-300",secondaryBackground:"bg-purple-800",highlight:"bg-pink-600 bg-opacity-30"},terminal:{name:"Terminal",background:"bg-black",text:"text-amber-400",secondaryText:"text-amber-600",accent:"bg-amber-800 text-amber-200",prompt:"text-amber-500",input:"bg-black border-amber-700 border",inputText:"text-amber-400",secondaryBackground:"bg-amber-900 bg-opacity-20",highlight:"bg-amber-700 bg-opacity-30"}},x=[{id:"xs",name:"Extra Small",class:"text-xs"},{id:"sm",name:"Small",class:"text-sm"},{id:"base",name:"Medium",class:"text-base"},{id:"lg",name:"Large",class:"text-lg"},{id:"xl",name:"Extra Large",class:"text-xl"}];function b(){var e;let{user:t,isSignedIn:s}=(0,o.aF)(),[a,r]=(0,i.useState)(""),[c,l]=(0,i.useState)([]),[u,b]=(0,i.useState)("> "),[f,y]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),[S,C]=(0,i.useState)("disconnected"),[j,N]=(0,i.useState)(null),[k,I]=(0,i.useState)(!1),[E,D]=(0,i.useState)([]),[T,M]=(0,i.useState)(-1),[A,O]=(0,i.useState)(!1),[R,U]=(0,i.useState)([]),G=(0,i.useRef)(null),L=(0,i.useRef)(null),_=(0,i.useRef)(new p),q=(0,i.useRef)(null),[P,F]=(0,i.useState)({theme:"shadowrunBarren",fontSize:"base",soundEnabled:!1,autoScroll:!0});(0,i.useEffect)(()=>{let e=localStorage.getItem("shadowrun-settings");if(e)try{let t=JSON.parse(e);F({...P,...t})}catch(e){console.error("Failed to parse settings:",e)}_.current.loadFromStorage(),b(s?"".concat((null==t?void 0:t.firstName)||"User","@SR > "):"> "),l([{command:"",output:'Shadowrun Interface Terminal v2.0\nEnhanced with real-time collaboration and advanced dice mechanics\nType "help" for available commands.\nInitializing Matrix connection...',timestamp:new Date,success:!0}])},[s,t]),(0,i.useEffect)(()=>{localStorage.setItem("shadowrun-settings",JSON.stringify(P))},[P]),(0,i.useEffect)(()=>{P.autoScroll&&L.current&&(L.current.scrollTop=L.current.scrollHeight)},[c,P.autoScroll]),(0,i.useEffect)(()=>{G.current&&G.current.focus()},[]),(0,i.useCallback)(e=>{"command_result"===e.type?W(e.command,e.output,new Date,!1,!1,e.success,!0,e.userId):"player_joined"===e.type?W("","\uD83C\uDFAE ".concat(e.username," joined the session"),new Date,!1,!1,!0,!1):"player_left"===e.type&&W("","\uD83D\uDC4B ".concat(e.username," left the session"),new Date,!1,!1,!0,!1)},[]),(0,i.useCallback)(e=>{C(e?"connected":"disconnected")},[]);let W=function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=!(arguments.length>5)||void 0===arguments[5]||arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;l(i=>[...i,{command:e,output:t,timestamp:s,isProcessing:n,isStreaming:a,success:r,broadcast:c,userId:o}])},B=()=>{if(a.trim()){let e=function(e){let t=e.toLowerCase();return(function(){let e=[];return Object.values(d).forEach(t=>{e.push(t.name),e.push(...t.aliases)}),e.sort()})().filter(e=>e.startsWith(t))}(a.trim());1===e.length?(r(e[0]+" "),I(!1)):e.length>1&&(D(e),I(!0),M(0))}},H=e=>{if(e.length>0){let t=function(e){let{command:t}=h(e),s=[];return Object.values(d).forEach(e=>{(e.name.startsWith(t)||e.aliases.some(e=>e.startsWith(t)))&&s.push(e)}),s.slice(0,5)}(e);U(t),O(t.length>0)}else O(!1),U([])},z=async e=>{if(e.preventDefault(),!a.trim()||f)return;let t=a.trim();r(""),I(!1),O(!1),_.current.addCommand(t),W(t,"",new Date,!0),await J(t)},J=async e=>{y(!0);try{if("clear"===e.toLowerCase()){l([]),y(!1);return}if(e.toLowerCase().startsWith("theme ")){let t=e.substring(6).trim();if(g[t]){let s={...P,theme:t};F(s),W(e,"Theme changed to ".concat(g[t].name),new Date,!1,!1,!0)}else W(e,"Theme not found. Available themes: ".concat(Object.keys(g).join(", ")),new Date,!1,!1,!1);y(!1);return}if("settings"===e.toLowerCase()){w(!0),W(e,"Opening settings panel...",new Date,!1,!1,!0),y(!1);return}let n=await m(e,{userId:(null==t?void 0:t.firstName)||"User",sessionId:null==j?void 0:j.id,isGM:(null==j?void 0:j.isGM)||!1,apiCall:async(e,t)=>(console.log("API Call:",e,t),{success:!0,data:null})});if("CLEAR_CONSOLE"===n.output)l([]);else{var s;W(e,n.output,new Date,!1,!1,n.success,n.broadcast),n.broadcast&&(null===(s=q.current)||void 0===s?void 0:s.isConnected())&&q.current.send({type:"command",command:e,result:n.output,userId:(null==t?void 0:t.firstName)||"User"})}}catch(t){console.error("Error processing command:",t),W(e,"Error: ".concat(t instanceof Error?t.message:"Unknown error processing command"),new Date,!1,!1,!1)}finally{y(!1)}},X=g[P.theme],$=(null===(e=x.find(e=>e.id===P.fontSize))||void 0===e?void 0:e.class)||"text-base";return(0,n.jsxs)("div",{className:"min-h-screen flex flex-col ".concat(X.background),children:[(0,n.jsx)("header",{className:"p-2 border-b border-red-900",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"".concat(X.prompt," font-mono font-bold"),children:"SHADOWRUN MATRIX INTERFACE v2.0"}),(0,n.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[(0,n.jsxs)("span",{className:X.secondaryText,children:["Status: ",(0,n.jsx)("span",{className:"connected"===S?"text-green-400":"connecting"===S?"text-yellow-400":"text-red-400",children:S.toUpperCase()})]}),j&&(0,n.jsxs)("span",{className:X.secondaryText,children:["Session: ",j.name," (",j.playerCount," players)"]})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)("button",{onClick:()=>w(!0),className:"px-3 py-1 rounded ".concat(X.accent," hover:opacity-80 text-sm"),children:"Settings"})})]})}),(0,n.jsx)("div",{ref:L,className:"flex-1 p-4 overflow-y-auto font-mono ".concat($," relative"),onClick:()=>{var e;return null===(e=G.current)||void 0===e?void 0:e.focus()},children:c.map((e,t)=>(0,n.jsxs)("div",{className:"mb-4",children:[e.command&&(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"".concat(X.prompt," mr-2 flex-shrink-0"),children:u}),(0,n.jsx)("span",{className:X.text,children:e.command}),e.broadcast&&(0,n.jsx)("span",{className:"ml-2 text-blue-400 text-xs",children:"\uD83D\uDCE1"})]}),(0,n.jsxs)("div",{className:"pl-4 whitespace-pre-wrap ".concat(!1===e.success?"text-red-400":X.secondaryText),children:[e.userId&&e.broadcast&&(0,n.jsxs)("span",{className:"text-blue-300",children:["[",e.userId,"] "]}),e.output,e.isProcessing&&(0,n.jsx)("span",{className:"streaming-cursor ml-1"})]}),(0,n.jsx)("div",{className:"text-xs text-gray-600 pl-4 mt-1",children:e.timestamp.toLocaleTimeString()})]},t))}),A&&R.length>0&&(0,n.jsxs)("div",{className:"absolute bottom-16 left-4 right-4 ".concat(X.secondaryBackground," border ").concat(X.input," rounded-lg p-3 z-10"),children:[(0,n.jsx)("div",{className:"text-sm font-bold mb-2 text-yellow-400",children:"Command Suggestions:"}),R.map((e,t)=>(0,n.jsxs)("div",{className:"text-xs mb-1",children:[(0,n.jsx)("span",{className:X.prompt,children:e.name}),(0,n.jsxs)("span",{className:X.secondaryText,children:[" - ",e.description]})]},t))]}),k&&E.length>0&&(0,n.jsx)("div",{className:"absolute bottom-16 left-4 ".concat(X.secondaryBackground," border ").concat(X.input," rounded-lg p-2 z-10"),children:E.map((e,t)=>(0,n.jsx)("div",{className:"px-2 py-1 cursor-pointer ".concat(t===T?X.highlight:""," ").concat(X.text),onClick:()=>{var t;r(e+" "),I(!1),null===(t=G.current)||void 0===t||t.focus()},children:e},t))}),(0,n.jsx)("form",{onSubmit:z,className:"p-2 border-t border-red-900",children:(0,n.jsxs)("div",{className:"flex items-center ".concat(X.input," p-2 rounded relative"),children:[(0,n.jsx)("span",{className:"".concat(X.prompt," mr-2 flex-shrink-0"),children:u}),(0,n.jsx)("input",{ref:G,type:"text",value:a,onChange:e=>{let t=e.target.value;r(t),H(t)},onKeyDown:e=>{switch(e.key){case"ArrowUp":e.preventDefault();let t=_.current.getPrevious();null!==t&&r(t);break;case"ArrowDown":e.preventDefault();let s=_.current.getNext();null!==s&&r(s);break;case"Tab":e.preventDefault(),B();break;case"Escape":I(!1),O(!1),_.current.reset();break;case"ArrowLeft":case"ArrowRight":I(!1)}},className:"flex-1 bg-transparent outline-none ".concat(X.inputText),disabled:f,placeholder:f?"Processing...":"Type a command... (Tab for auto-complete, ↑↓ for history)",autoComplete:"off"}),f&&(0,n.jsx)("div",{className:"ml-2",children:(0,n.jsx)("span",{className:"streaming-cursor"})})]})}),v&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"".concat(X.secondaryBackground," p-6 rounded-lg max-w-md w-full mx-4"),children:[(0,n.jsx)("h2",{className:"".concat(X.prompt," text-xl font-bold mb-4"),children:"Console Settings"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"".concat(X.text," block mb-2"),children:"Theme"}),(0,n.jsx)("select",{value:P.theme,onChange:e=>F({...P,theme:e.target.value}),className:"w-full p-2 bg-gray-800 text-white rounded",children:Object.entries(g).map(e=>{let[t,s]=e;return(0,n.jsx)("option",{value:t,children:s.name},t)})})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"".concat(X.text," block mb-2"),children:"Font Size"}),(0,n.jsx)("select",{value:P.fontSize,onChange:e=>F({...P,fontSize:e.target.value}),className:"w-full p-2 bg-gray-800 text-white rounded",children:x.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",checked:P.soundEnabled,onChange:e=>F({...P,soundEnabled:e.target.checked}),className:"mr-2"}),(0,n.jsx)("span",{className:X.text,children:"Enable Sound Effects"})]})}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",checked:P.autoScroll,onChange:e=>F({...P,autoScroll:e.target.checked}),className:"mr-2"}),(0,n.jsx)("span",{className:X.text,children:"Auto-scroll Console"})]})}),(0,n.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,n.jsx)("button",{onClick:()=>_.current.clearHistory(),className:"px-4 py-2 rounded bg-red-700 text-red-100 hover:bg-red-600",children:"Clear History"}),(0,n.jsx)("button",{onClick:()=>w(!1),className:"px-4 py-2 rounded ".concat(X.accent),children:"Close"})]})]})})]})}function f(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r(),{children:[(0,n.jsx)("title",{children:"Shadowrun Interface | Enhanced Console"}),(0,n.jsx)("meta",{name:"description",content:"Enhanced Shadowrun RPG terminal interface with real-time collaboration"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,n.jsx)(c.CH,{children:(0,n.jsx)("div",{className:"min-h-screen bg-gray-950 flex flex-col",children:(0,n.jsx)(b,{})})}),(0,n.jsx)(c.tj,{children:(0,n.jsx)(o.N1,{})})]})}},9090:function(e,t,s){"use strict";s.d(t,{FW:function(){return c},du:function(){return o}});var n=s(7066);let a=s(3454).env.NEXT_PUBLIC_API_URL||"http://localhost:5000",r=n.Z.create({baseURL:a,timeout:1e4,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{let t=localStorage.getItem("shadowrun-session-token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>{var t;return console.error("API Error:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),Promise.reject(e)});let c={async createSession(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return(await r.post("/sessions",{name:e,maxPlayers:t})).data},joinSession:async(e,t)=>(await r.post("/sessions/".concat(e,"/join"),{password:t})).data,async leaveSession(e){await r.post("/sessions/".concat(e,"/leave"))},getActiveSessions:async()=>(await r.get("/sessions")).data,getSessionInfo:async e=>(await r.get("/sessions/".concat(e))).data};class o{connect(e,t,s){this.sessionId=e,this.onMessageCallback=t,this.onConnectionCallback=s;let n="".concat(a.replace("http","ws"),"/ws/").concat(e);try{this.ws=new WebSocket(n),this.ws.onopen=()=>{var e;console.log("WebSocket connected"),this.reconnectAttempts=0,null===(e=this.onConnectionCallback)||void 0===e||e.call(this,!0)},this.ws.onmessage=e=>{try{var t;let s=JSON.parse(e.data);null===(t=this.onMessageCallback)||void 0===t||t.call(this,s)}catch(e){console.error("Failed to parse WebSocket message:",e)}},this.ws.onclose=()=>{var e;console.log("WebSocket disconnected"),null===(e=this.onConnectionCallback)||void 0===e||e.call(this,!1),this.attemptReconnect()},this.ws.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){var r;console.error("Failed to create WebSocket connection:",e),null===(r=this.onConnectionCallback)||void 0===r||r.call(this,!1)}}attemptReconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&this.sessionId&&(this.reconnectAttempts++,console.log("Attempting to reconnect (".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")...")),setTimeout(()=>{this.sessionId&&this.onMessageCallback&&this.connect(this.sessionId,this.onMessageCallback,this.onConnectionCallback)},this.reconnectDelay*this.reconnectAttempts))}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message")}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.sessionId=null,this.onMessageCallback=void 0,this.onConnectionCallback=void 0}isConnected(){var e;return(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}constructor(){this.ws=null,this.sessionId=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3}}},1265:function(e,t,s){"use strict";function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=[],n=[];for(let t=0;t<e;t++)s.push(Math.floor(6*Math.random())+1);if(t.edge||t.explodingDice){let e=s.filter(e=>6===e).length;for(;e>0;){for(let t=0;t<e;t++){let e=Math.floor(6*Math.random())+1;n.push(e)}e=n.filter(e=>6===e).length}}if(t.rerollOnes)for(let e=0;e<s.length;e++)1===s[e]&&(s[e]=Math.floor(6*Math.random())+1);let a=[...s,...n],r=a.filter(e=>e>=5).length,c=s.filter(e=>1===e).length,o=a.filter(e=>6===e).length,i=t.limit&&!t.pushTheLimit?Math.min(r,t.limit):r,l=c>Math.floor(e/2);return{dice:e,results:a,hits:i,ones:c,sixes:o,isGlitch:l,isCriticalGlitch:l&&0===i,exploded:n}}function a(e){let t=e.toLowerCase().trim(),s=t.match(/^(\d+)(?:\s*(?:limit|l)\s*(\d+))?(?:\s*(edge|e))?$/);if(s)return n(parseInt(s[1]),{limit:s[2]?parseInt(s[2]):void 0,edge:!!s[3]});if(t.match(/^\d+d\d+([+-]\d+)?$/))return function(e){let t=e.match(/(\d+)d(\d+)([+-]\d+)?/i);if(!t)throw Error('Invalid dice notation. Use format like "3d6" or "2d8+2"');let s=parseInt(t[1]),n=parseInt(t[2]),a=t[3]?parseInt(t[3]):0,r=[];for(let e=0;e<s;e++)r.push(Math.floor(Math.random()*n)+1);let c=r.reduce((e,t)=>e+t,0)+a;return{dice:s,results:r,hits:0,ones:0,sixes:0,isGlitch:!1,isCriticalGlitch:!1,total:c,exploded:[]}}(t);let a=t.match(/^init(?:iative)?(?:\s+(\d+))?$/);if(a){let e=a[1]?parseInt(a[1]):8,t=Math.floor(6*Math.random())+1;return{dice:1,results:[t],hits:0,ones:0,sixes:0,isGlitch:!1,isCriticalGlitch:!1,total:t+e,exploded:[]}}throw Error('Invalid dice command. Try: "12" (SR dice), "3d6" (standard), or "init 12" (initiative)')}function r(e,t){let s="Rolling ".concat(t,"...\n");return void 0!==e.total?s+="Results: [".concat(e.results.join(", "),"]\n")+"Total: ".concat(e.total):(s+="Results: [".concat(e.results.join(", "),"]\n")+"Hits: ".concat(e.hits),e.exploded.length>0&&(s+=" (+ ".concat(e.exploded.length," exploded dice: [").concat(e.exploded.join(", "),"])")),e.isCriticalGlitch?s+="\n\uD83D\uDC80 CRITICAL GLITCH! (".concat(e.ones," ones, no hits)"):e.isGlitch&&(s+="\n⚠️ Glitch! (".concat(e.ones," ones)")),0!==e.hits||e.isCriticalGlitch?e.hits>=4?s+="\n✨ Excellent success!":e.hits>=2?s+="\n✅ Good success!":1===e.hits&&(s+="\n\uD83D\uDC4D Marginal success"):s+="\n❌ No hits - failure!"),s}function c(e,t){let s={edge:!0};switch(t){case"reroll":s.rerollOnes=!0;break;case"explode":s.explodingDice=!0;break;case"pushLimit":s.pushTheLimit=!0}return n(e,s)}s.d(t,{EA:function(){return r},_p:function(){return c},iI:function(){return a}})}},function(e){e.O(0,[703,888,774,179],function(){return e(e.s=2011)}),_N_E=e.O()}]);